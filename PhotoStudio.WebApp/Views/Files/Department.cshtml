
@{
    ViewBag.Title = "Department";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@using PhotoStudio.Common;
@using PhotoStudio.Model;
<script type="text/javascript">
    function DepaAdd(data) {

        var serverData = data.split(':');
        if (serverData[0] == "ok") {
            $("#sussMsg").html("<div class=\"alert alert-success alert-dismissible\" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button><i class=\"fa fa-check-circle m-right-xs\"></i><strong>" + serverData[1] + "！</strong></div>");
        }
        else if (serverData[0] == "no") {
            $("#sussMsg").html("<div class=\"alert alert-danger alert-dismissible\" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button><i class=\"fa fa-times-circle m-right-xs\"></i> <strong>" + serverData[1] + "!</strong></div>");
        }
        else {
            window.location.href = "/Home/Index";
            $("#sussMsg").html("<div class=\"alert alert-warning alert-dismissible\" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button><i class=\"fa fa-exclamation-circle m-right-xs\"></i> <strong>系统繁忙！</strong></div>");
        }
    }
    function DepaDel(data) {

        var serverData = data.split(':');
        if (serverData[0] == "ok") {
            $("#sussMsg2").html("<div class=\"alert alert-success alert-dismissible\" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button><i class=\"fa fa-check-circle m-right-xs\"></i><strong>" + serverData[1] + "！</strong></div>");
        }
        else if (serverData[0] == "no") {
            $("#sussMsg2").html("<div class=\"alert alert-danger alert-dismissible\" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button><i class=\"fa fa-times-circle m-right-xs\"></i> <strong>" + serverData[1] + "!</strong></div>");
        }
        else {
            window.location.href = "/Home/Index";
            $("#sussMsg2").html("<div class=\"alert alert-warning alert-dismissible\" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button><i class=\"fa fa-exclamation-circle m-right-xs\"></i> <strong>系统繁忙！</strong></div>");
        }
    }
    function DepaEdit(data) {

        var serverData = data.split(':');
        if (serverData[0] == "ok") {
            $("#sussMsg").html("<div class=\"alert alert-success alert-dismissible\" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button><i class=\"fa fa-check-circle m-right-xs\"></i><strong>" + serverData[1] + "！</strong></div>");
        }
        else if (serverData[0] == "no") {
            $("#sussMsg").html("<div class=\"alert alert-danger alert-dismissible\" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button><i class=\"fa fa-times-circle m-right-xs\"></i> <strong>" + serverData[1] + "!</strong></div>");
        }
        else {
            window.location.href = "/Home/Index";
            $("#sussMsg").html("<div class=\"alert alert-warning alert-dismissible\" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button><i class=\"fa fa-exclamation-circle m-right-xs\"></i> <strong>系统繁忙！</strong></div>");
        }
    }
</script>
<div class="padding-md">
    <h2 class="header-text">
        部门档案
        <span class="sub-header">
            摄影工作室
        </span>
    </h2>
    <div class="smart-widget m-top-lg widget-dark-blue">
        <div class="smart-widget-header">
            部门添加
            <span class="smart-widget-option">
                <span class="refresh-icon-animated">
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                </span>
                <a href="#" class="widget-toggle-hidden-option">
                    <i class="fa fa-cog"></i>
                </a>
                <a href="#" class="widget-collapse-option" data-toggle="collapse">
                    <i class="fa fa-chevron-up"></i>
                </a>
            </span>
        </div>
        <div class="smart-widget-inner">
            <div class="smart-widget-hidden-section">
                <ul class="widget-color-list clearfix">
                    <li style="background-color:#20232b;" data-color="widget-dark"></li>
                    <li style="background-color:#4c5f70;" data-color="widget-dark-blue"></li>
                    <li style="background-color:#23b7e5;" data-color="widget-blue"></li>
                    <li style="background-color:#2baab1;" data-color="widget-green"></li>
                    <li style="background-color:#edbc6c;" data-color="widget-yellow"></li>
                    <li style="background-color:#fbc852;" data-color="widget-orange"></li>
                    <li style="background-color:#e36159;" data-color="widget-red"></li>
                    <li style="background-color:#7266ba;" data-color="widget-purple"></li>
                    <li style="background-color:#f5f5f5;" data-color="widget-light-grey"></li>
                    <li style="background-color:#fff;" data-color="reset"></li>
                </ul>
            </div>
            <div class="smart-widget-body">
                @using (Ajax.BeginForm("DepaAdd", new { }, new AjaxOptions() { HttpMethod = "post", OnSuccess = "DepaAdd" }, new { id = "DepaAdd", @class = "form-horizontal " }))
                {
                    <div id="sussMsg"> </div>
                    <div class="form-group">
                        <label class="col-md-2 col-md-offset-3 text-right">部门名称</label>

                        @Html.TextBox("name", "", new { @class = "col-md-6 form-control", @placeholder = "Name" })
                    </div>
                    <div class="form-group">
                        <label class="col-md-2 col-md-offset-3 text-right">部门权限</label>
                        @Html.DropDownList("root", (List<SelectListItem>)ViewBag.Letters, new { @class = "col-md-6 form-control", @placeholder = "name" });

                    </div>
                    <div class="form-group">
                        <div class="col-md-offset-5">
                            <button type="submit" class="btn btn-success">确定添加</button>
                            <button type="reset" class="btn btn-default">重置</button>
                        </div>
                    </div>
                }
            </div>
        </div><!-- ./smart-widget-inner -->
    </div><!-- ./smart-widget -->
    <div class="smart-widget widget-purple">
        <div class="smart-widget-header">
            部门列表
            <span class="smart-widget-option">
                <span class="refresh-icon-animated">
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                </span>
                <a href="#" class="widget-toggle-hidden-option">
                    <i class="fa fa-cog"></i>
                </a>
                <a href="#" class="widget-collapse-option" data-toggle="collapse">
                    <i class="fa fa-chevron-up"></i>
                </a>
            </span>
        </div>
        <div class="smart-widget-inner">
            <div class="smart-widget-hidden-section">
                <ul class="widget-color-list clearfix">
                    <li style="background-color:#20232b;" data-color="widget-dark"></li>
                    <li style="background-color:#4c5f70;" data-color="widget-dark-blue"></li>
                    <li style="background-color:#23b7e5;" data-color="widget-blue"></li>
                    <li style="background-color:#2baab1;" data-color="widget-green"></li>
                    <li style="background-color:#edbc6c;" data-color="widget-yellow"></li>
                    <li style="background-color:#fbc852;" data-color="widget-orange"></li>
                    <li style="background-color:#e36159;" data-color="widget-red"></li>
                    <li style="background-color:#7266ba;" data-color="widget-purple"></li>
                    <li style="background-color:#f5f5f5;" data-color="widget-light-grey"></li>
                    <li style="background-color:#fff;" data-color="reset"></li>
                </ul>
            </div>
            <div class="smart-widget-body">
                <div id="sussMsg2"> </div>
                <table class="table table-striped table-bordered" id="dataTable">
                    <thead>
                        <tr class="bg-dark-blue">
                            <th>部门编号</th>
                            <th>部门名称</th>
                            <th>部门权限</th>
                            <th>部门成员</th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.lCount > 0)
                        {
                            foreach (PhotoStudio.Model.Sector n in ViewBag.listSector)
                            {
                                string root = "";
                                string stafflist = "";
                                try
                                {
                                    int seid = Convert.ToInt32(n.Power);
                                    PhotoStudio.Model.Power m = new PhotoStudio.BLL.Power().GetModel(seid);
                                    root = m.Name;
                                }
                                catch
                                {
                                    if (n.Power != "0")
                                    {
                                        root = "最高权限";
                                    }
                                }

                                {
                                    List<PhotoStudio.Model.Staff> sta = new PhotoStudio.BLL.Staff().GetModelList("SeID=" + n.ID);
                                    foreach (PhotoStudio.Model.Staff sf in sta)
                                    {
                                        stafflist = stafflist + "[" + sf.ID + "." + sf.Name + "]";
                                    }
                                }
                                <tr>
                                    <td>@n.ID</td>
                                    <td>@n.Name</td>
                                    <td>@root</td>
                                    <td>@stafflist</td>
                                    <td>
                                        @using (Ajax.BeginForm("Edit", new { }, new AjaxOptions() { HttpMethod = "post", OnSuccess = "DepaEdit" }, new { id = "DepaEdit", @class = "form-horizontal " }))
                                        {
                                            @Html.TextBox("ID", @n.ID, new { @type = "hidden" })
                                            <button type="submit" class="btn btn-success">修改</button>
                                        }
                                    </td>
                                    <td>
                                        @using (Ajax.BeginForm("DepaDel", new { }, new AjaxOptions() { HttpMethod = "post", OnSuccess = "DepaDel" }, new { id = "DepaDel", @class = "form-horizontal " }))
                                        {
                                            @Html.TextBox("delid", @n.ID, new { @type = "hidden" })
                                            <button type="submit" class="btn btn-success">删除</button>
                                        }
                                    </td>
                                </tr>

                            }

                        }
                        else
                        {

                        }

                    </tbody>
                </table>
                <nav class="text-center">
                    <ul class="pagination pagination-lg">
                        @MvcHtmlString.Create(PageBar.GetPagebar((int)ViewBag.Index, (int)ViewBag.lCount));
                    </ul>
                </nav>
            </div>
        </div><!-- ./smart-widget-inner -->
    </div><!-- ./smart-widget -->
</div>